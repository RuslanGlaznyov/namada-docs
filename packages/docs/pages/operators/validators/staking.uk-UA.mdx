# Стейкінг

Ми обговорюємо два типи зв'язку: 
1. [Non-self bonding](#не-самозв'язок-делегування) (називається делегуванням у багатьох інших екосистемах, але не плутати з делегуванням управління на Namad)
2. [Self-bonding](#self-bonding) (самостійне зв'язування)

## Делегування (Non-self bonding)

Користувачі можуть зв'язатися з будь-якою кількістю валідаторів у будь-який час. Коли користувач зв'язує токени, вони не будуть зараховані до частки валідатора (яка, в свою чергу, визначає його право голосу) до початку епохи `n + 2` в поточній епосі `n` (літерал `2` задається параметром PoS `pipeline_len`). Облігації будуть негайно списані з рахунку бондера і зараховані на рахунок системи PoS.

Прив'язати токени з адреси джерела з псевдонімом `aliace` до валідатора з псевдонімом `validator-1`:

```shell copy
namada client bond \
  --source aliace \
  --validator validator-1 \
  --amount 12.34
```

Ви можете зробити запит на свої делегації, використовуючи:

```shell copy
namada client bonds --owner aliace
```

Результат цього запиту покаже епоху, з якої будуть активні ваші облігації.

Оскільки система PoS - це всього лише рахунок, ви можете запитати його баланс, який є сумою всіх облігацій, а також незв'язаних токенів, які ще не були виведені:

```shell copy
namada client balance --owner PoS
```

## Self-bonding

Також можна збільшити кількість голосів валідатора, зв'язавши NAM з ліквідного балансу валідатора на себе. Користувач може відправити транзакцію самооблігації токенів з акаунта валідатора в систему PoS за допомогою сервісу самооблігації:

```shell copy
namada client bond \
  --validator my-validator \
  --amount 3.3
```

## Запит до валідатора `bonded-stake`

Стейк валідатора (право голосу в cometbft) визначається сумою всіх його активних самооблігацій і облігацій від делегаторів, з додаванням косих рисок, якщо такі є.

Коли токени не зв'язані, зв'язана сума не враховується до частки валідатора до початку епохи `n + 2` в поточній епосі `n`. Облігаційна сума токенів буде негайно списана з рахунку валідатора і зарахована на рахунок системи PoS.

Побачити всіх валідаторів і їх кількість голосів, яка в точності дорівнює кількості заставлених токенів NAM з їх самооблігацій і делегованих облігацій, ви можете за допомогою запиту:

```shell copy
namada client bonded-stake
```

За допомогою цієї команди ви можете вказати `--epoch`, щоб знайти кількість голосів для деякої майбутньої епохи. Зауважте, що остаточними є лише голоси для поточної та наступної епох.

## Штрафування

Якщо валідатор демонструє карану поведінку, то зв'язки з цим валідатором також підлягають вилученню. Тільки ті зв'язки, які були активні в епоху, коли сталася помилка, будуть розірвані зі швидкістю розриву, що відповідає типу помилки. Якщо будь-яка з ваших облігацій була розірвана, це буде відображено в запиті `bonds`. Ви також можете знайти всі штрафи:

```shell copy
namada client slashes
```

## Відкріплення (Unbonding)

Поки токени зв'язані, вони заблоковані в системі PoS і, отже, не є ліквідними, поки бондер не виведе їх. Для цього бондеру спочатку потрібно відправити транзакцію, щоб "розблокувати" свої токени. Користувач може від'єднати будь-яку суму, аж до суми всіх своїх бондів даному валідатору, ще до того, як бонди стануть активними.

### Відкріплення з іншого валідатора (Non-self unbonding)
Подати валідатору запит на відв'язування токенів від адреси джерела:
```shell copy
namada client unbond \
  --source aliace \
  --validator validator-1 \
  --amount 1.2
```

### Відкріплення токенів з валідатора (Self-unbonding)

Подати заявку на відкріплення самозв'язаних токенів від валідатора:
```shell copy
namada client unbond \
  --validator my-validator \
  --amount 0.3
```

## Виведення відкріплених токенів токенів (unbonds tokens) 
Коли користувач відкріплює токени, він не зможе вивести їх одразу. Замість цього, токени, відкріплені в епоху `n`, будуть доступні для виведення, починаючи з епохи `n + 6` (літерал `6` задається PoS-параметром `unbonding_len`). Після того, як токени будуть розблоковані, користувач зможе побачити, коли він зможе їх вивести за допомогою запиту `bonds`:

```shell copy
namada client bonds --owner aliace
```

Коли ланцюжок досягає епохи, в якій можна виводити токени (або в будь-який час після цього), `aliace` може подати заявку на виведення незв'язаних токенів назад на свій рахунок:

```shell copy
namada client withdraw \
  --source aliace \
  --validator validator-1
```

У разі успіху, вилучені токени будуть зараховані на рахунок `aliace` і списані з системи PoS.

