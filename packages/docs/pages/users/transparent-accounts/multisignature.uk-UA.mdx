import { Callout } from 'nextra-theme-docs'

# Облікові записи з мультипідписом на Namada

Облікові записи з мультипідписом(multisigs) - це облікові записи в Namada, які дозволяють використовувати декілька підписів. Використання мультипідписів має багато переваг, включаючи, але не обмежуючись ними. 

- Підвищена безпека
- Можливість спільного використання гаманців
- Кращі можливості відновлення

З цієї причини всі акаунти на Namada за замовчуванням є акаунтами з мультипідписом.

## Ініціалізація облікового запису мультипідпису

Перед створенням облікового запису користувач повинен згенерувати принаймні один криптографічний `ключ`, який буде використовуватися для підписання транзакцій.

Наступний метод згенерує такий ключ:
```shell
namadaw key gen \
--alias my-key1
```
Також можна згенерувати другий ключ (що буде корисно для мультисигналів):
```shell
namadaw key gen \
--alias my-key2
```

Також можна згенерувати неявну адресу:
```shell
namadaw address gen \
--alias my-address
```

Ініціалізація рахунків на Namada відбувається наступним чином:

**Обліковий запис без мультипідпису (з одним підписом)**.
```shell
namadac init-account \
--alias my-multisig-alias \
--public-keys my-key1 \
--signing-keys my-key1
```

**Мультипідписний рахунок (щонайменше 2 підписанти)**.
```shell
namadac init-account \
--alias my-multisig-alias \
--public-keys my-key1,my-key2 \
--signing-keys my-key1,my-key2 \
--threshold 2
```


## Відправлення транзакції з мультипідписом
Для того, щоб відправити транзакцію з мультипідписом, спочатку необхідно створити офлайн-транзакцію. 

### Створення офлайн-транзакції
<Callout type="warning">
Починаючи з `v0.23.0` існують певні обмеження щодо побудови офлайн-транзакції. Будь ласка, зверніть увагу на будь-які помилки, що можуть виникнути.
</Callout>

Аргумент `--dump-tx` дозволяє користувачеві зробити це. Необхідно вказати папку, куди буде скинуто транзакцію.

```shell
mkdir tx_dumps
```

Це можна зробити наступним способом:
```shell
namadac transfer \
--source my-multisig-alias \
--target some-established-account-alias \
--token NAM \
--amount 100 \
--signing-keys my-key1 \
--dump-tx \
--output-folder-path tx_dumps
```

Це означає, що транзакція створена і готова до підписання. 

У вказаній папці буде створено файл `.tx`. Цей файл містить шістнадцяткове представлення байт транзакції. Цей файл можна використовувати для підписання транзакції.

### Підписання транзакції

Наступним кроком буде підписання транзакції. Користувач `my-key1` може підписати транзакцію наступним чином:
```shell
namadac sign-tx \
--tx-path "<path-to-file>" \
--signing-keys my-key1 \
--owner my-multisig-alias
```

<Callout type="info">
Зауважте, що на цьому етапі транзакцію може бути підписано будь-якою кількістю `--signing-keys`.
 У результаті буде створено декілька підписів, які можна використовувати для відправлення транзакції.
</Callout>


Це означає, що підпис було збережено до цього файлу (розташованого у поточному каталозі). 

Збережемо його як псевдонім:
```shell
export SIGNATURE_ONE="offline_signature_FB7246E3FC43F59D8AEEC234EBFDB9DF1AC9BB7B14E536D05A7E2617CA41D4CD_0.tx"
```

Забезпечте підписання транзакції щонайменше k-з-n ключами, де k - мінімальна кількість підписів, необхідних для відправлення транзакції, а n - загальна кількість ключів. У нашому прикладі k=2 і n=2.

Припустимо, що це підписання створює ще один підпис, який ми збережемо під псевдонімом `SIGNATURE_TWO`.

### Відправлення транзакції

Останнім кроком є відправка транзакції. Це можна зробити за допомогою наступного методу:

```shell
namadac tx \
--tx-path "tx_dumps/a45ef98a817290d6fc0efbd480bf66647ea8061aee1628ce09b4af4f4eeed1c2.tx" \
--signatures $SIGNATURE_ONE \
--signatures $SIGNATURE_TWO \
--owner my-multisig-alias \
--gas-payer my-key1
```

<Callout type="info">
Зверніть увагу на відсутність ком в аргументі `--signatures`. Це пов'язано з тим, що аргумент є списком файлів, а не списком підписів.
Також зверніть увагу на папку `tx_dumps`. Це тека, до якої було створено дамп транзакції, як зазначено у параметрі `--output-folder-path` на попередньому кроці.
</Callout>

## Зміна порогу мультипідпису
Існує можливість змінити поріг мультипідпису для акаунта. Це можна зробити наступним способом:
```shell
namadac update-account \
--address my-multisig-address \
--threshold 1 \
--signing-keys my-key1,my-key2
```

Перевірити, чи правильно було оновлено поріг, можна за допомогою пробіжки:
```shell
namadac query-account \
--owner my-multisig-address
```
Що дасть поріг 1 разом з двома відкритими ключами.

## Зміна відкритих ключів облікового запису multisig
Існує можливість змінити відкриті ключі мультисигнального акаунта. Це можна зробити наступним способом:
```shell
namadac update-account \
--address my-multisig-address \
--public-keys my-key3,my-key4,my-key5 \
--signing-keys my-key1,my-key2
```

Що змінить відкриті ключі облікового запису multisig з `my-key1` і `my-key2` на ключі `my-key3`, `my-key4` і `my-key5` (за умови, що вони існують в гаманці).

Відкриті ключі, надані аргументу `--public-keys`, стануть новими підписантами мультипідпису. Це має бути список відкритих ключів, розділених комами і без пробілів. У списку має бути щонайменше 1 відкритий ключ, а довжина списку має бути не меншою за поріг облікового запису multisig.

## Відеоурок

Пропустіть нудне читання і подивіться відеоурок:

<iframe src="https://player.vimeo.com/video/873749851?h=ee68c142e2&title=0&byline=0&portrait=0" width="640" height="416" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
